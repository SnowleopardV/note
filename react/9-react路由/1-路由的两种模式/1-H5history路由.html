<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <button onclick="gotoHome()">点击跳转到首页</button>
  <button onclick="gotoList()">点击跳转到列表</button>
  <button onclick="replaceDetail()">点击跳转到详情</button>
  <button onclick="forward()">前进</button>
  <button onclick="back()">回退</button>
  <button onclick="dispatcCustomhEvent()">window抛出事件</button>
  <script>
    console.log(12, history)
    // 一、pushState
    // state是一个JavaScript对象，可以存储一些与URL相关的数据
    // title是一个字符串，通常被浏览器用于显示页面标题
    // url是一个包含当前url的字符串

    function gotoHome() {
      history.pushState({
          page: 'home',
        },
        'HomePage',
        '/home'
      )
    }

    function gotoList() {
      history.pushState({
          page: 'list',
        },
        'ListPage',
        '/list'
      )
    }

    // 二、pushState
    // state是一个JavaScript对象，可以存储一些与URL相关的数据
    // title是一个字符串，通常被浏览器用于显示页面标题
    // url是一个包含当前url的字符串
    function replaceDetail() {
      history.replaceState({
          page: 'detail',
        },
        'DetailPage',
        '/detail'
      )
    }

    // 三、go、forward、back
    function forward() {
      history.forward()
    }

    function back() {
      history.back()
    }

    // 四、监听popState事件
    window.addEventListener('popstate', () => {
      console.log(65, history.length)
    })

    // 五、监听pushState和replaceState事件
    // 原生不支持监听pushState和replaceState事件, 重写该事件
    // 1. 高阶函数封装自定义事件
    const bindNewHistoryEvent = (type) => {
      const historyEvent = history[type]

      return function () {
        const newHistoryEvent = historyEvent.apply(this, arguments)
        const e = new Event(type)
        e.arguments = arguments
        window.dispatchEvent(e)
        return newHistoryEvent
      }
    }

    // 2. 重写history方法
    history.pushState = bindNewHistoryEvent('pushState')
    history.replaceState = bindNewHistoryEvent('replaceState')

    // 3. 监听事件
    window.addEventListener('pushState', () => {
      console.log(88, 'pushState')
    })

    window.addEventListener('replaceState', () => {
      console.log(92, 'replaceState')
    })


    // 六、自定义window事件
    function dispatcCustomhEvent() {
      // window抛出事件
      const e = new Event('hahahhahah')
      e.data = {
        name: 'jack',
        age: 100
      }
      window.dispatchEvent(e)
    }

    // 监听自定义window事件
    window.addEventListener('hahahhahah', (data) => {
      console.log(101, data)
    })
  </script>
</body>

</html>