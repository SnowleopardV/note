<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
  <div id="root"></div>
  <div id="root2"></div>
  <script type="text/babel">
    // 1. 创建类组件
    class ClComponent extends React.Component {
      constructor(props) {
        // 必须要执行这一步, 除非该组件没有构造器
        super(props)
        // 初始化state
        this.state = { isSunny: true, temprature: 10 } 
      }
      changeWeather() {
        console.log(25, this)
        // 注意: 
        // 1. 状态不能直接更改, 需要调用React内置的API setState
        // setState是合并的动作, 不是替换的动作
        // this.state.isSunny = !this.state.isSunny

        // 2. setState 是异步更新

        // setState的二种写法: 对象式的setState、函数式的setState
        
        // 第一种写法 (
          // 1. 没有callback
          // this.setState({ isSunny: !this.state.isSunny })

          // 2. 有callback
          // this.setState({ isSunny: !this.state.isSunny }, () => {
          //   // 状态更新完毕(异步更新), 并且执行完render完成界面更新之后调用
          //   console.log(37, this.state.isSunny)
          // })
          // console.log(40, this.state.isSunny)

        // 第二种写法
          // 1. 没有callback
          // this.setState((state, props) => {
          //   console.log(50, state, props, state.isSunny, props.flag, state.isSunny && props.flag)
          //   return ({isSunny: state.isSunny && props.flag})
          // })

        // 有callback
        this.setState((state, props) => {
          console.log(50, state, props, state.isSunny, props.flag, state.isSunny && props.flag)
          return ({isSunny: state.isSunny && props.flag})
        }, () => {
          console.log(59, this.state.isSunny)
        })

        console.log(62, this.state.isSunny)

      }
      changeTemprature() {
        this.setState({ temprature: this.state.temprature + 1 })
      }
      render() {
        // 读取状态
        return (
          <div>
            <h1 onClick={this.changeWeather.bind(this)}>今天天气是{ this.state.isSunny ? '晴天' : '下雨了'  }</h1>
            <h2 onClick={this.changeTemprature.bind(this)}>温度 { this.state.temprature } 度</h2>
          </div>
        )
      }
    }

    // 类组件的简写方式
    // 建议采用如下写法: 
    // 1. 代码更简洁
    // 2. 因为箭头函数中没有自己的this,   this的指向是函数定义时外层的this
    class ClComponent2 extends React.Component{
      state = { isSunny: true, temprature: 10 }
      changeWeather = () => this.setState({ isSunny: !this.state.isSunny })
      changeTemprature = () => this.setState({ temprature: this.state.temprature + 1 })
      render = () => (
          <div>
            <h1 onClick={this.changeWeather}>今天天气是{ this.state.isSunny ? '晴天' : '下雨了'  }</h1>
            <h2 onClick={this.changeTemprature}>温度 { this.state.temprature } 度</h2>
          </div>  
        )
    }

    // 2. 渲染类组件到页面上
    ReactDOM.render(<ClComponent flag={false} />, document.getElementById('root'))
    // ReactDOM.render(<ClComponent2/>, document.getElementById('root2'))
  </script>
</body>

</html>